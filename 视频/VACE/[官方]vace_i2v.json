{"id":"96995b8f-85c5-47af-b3cf-7b6a24675694","revision":0,"last_node_id":104,"last_link_id":175,"nodes":[{"id":58,"type":"TrimVideoLatent","pos":[989.7294311523438,534.3240356445312],"size":[276.5860290527344,58],"flags":{"collapsed":true},"order":18,"mode":0,"inputs":[{"localized_name":"samples","name":"samples","type":"LATENT","link":116},{"localized_name":"trim_amount","name":"trim_amount","type":"INT","widget":{"name":"trim_amount"},"link":115}],"outputs":[{"localized_name":"LATENT","name":"LATENT","type":"LATENT","links":[117]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"TrimVideoLatent"},"widgets_values":[0]},{"id":8,"type":"VAEDecode","pos":[1159.7296142578125,534.3240356445312],"size":[210,46],"flags":{"collapsed":true},"order":19,"mode":0,"inputs":[{"localized_name":"samples","name":"samples","type":"LATENT","link":117},{"localized_name":"vae","name":"vae","type":"VAE","link":76}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","slot_index":0,"links":[130,139]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"VAEDecode"},"widgets_values":[]},{"id":78,"type":"Canny","pos":[630,680],"size":[270,82],"flags":{},"order":14,"mode":4,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":140},{"localized_name":"low_threshold","name":"low_threshold","type":"FLOAT","widget":{"name":"low_threshold"},"link":null},{"localized_name":"high_threshold","name":"high_threshold","type":"FLOAT","widget":{"name":"high_threshold"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[141,174]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"Canny"},"widgets_values":[0.4,0.8]},{"id":80,"type":"MarkdownNote","pos":[630,810],"size":[270.8102111816406,186.98114013671875],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["You can replace this part with another image preprocessor. \n\nRelated custom node: \n[comfyui_controlnet_aux](https://github.com/Fannovel16/comfyui_controlnet_aux)\n\n可以把这部分替换成其它的图像预处理器\n"],"color":"#432","bgcolor":"#653"},{"id":77,"type":"MarkdownNote","pos":[-750,0],"size":[440,410],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["[Tutorial](https://docs.comfy.org/tutorials/video/wan/vace) | [教程](https://docs.comfy.org/zh-CN/tutorials/video/wan/vace)\n\n\n**diffusion_models** \n\n- [wan2.1_vace_14B_fp16.safetensors](https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/diffusion_models/wan2.1_vace_14B_fp16.safetensors)\n\n**VAE**\n- [wan_2.1_vae.safetensors](https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/vae/wan_2.1_vae.safetensors?download=true)\n\n**Text encoders**   Chose one of following model\n- [umt5_xxl_fp16.safetensors](https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/text_encoders/umt5_xxl_fp16.safetensors?download=true)\n- [umt5_xxl_fp8_e4m3fn_scaled.safetensors](https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/text_encoders/umt5_xxl_fp8_e4m3fn_scaled.safetensors?download=true)\n\n> You can choose between fp16 of fp8; I used fp16 to match what kijai's wrapper is compatible with.\n\nFile save location\n\n```\nComfyUI/\n├── models/\n│   ├── diffusion_models/\n│   │   └─── wan2.1_vace_14B_fp16.safetensors\n│   ├── text_encoders/\n│   │   └─── umt5_xxl_fp8_e4m3fn_scaled.safetensors # or fp16\n│   └── vae/\n│       └──  wan_2.1_vae.safetensors\n```\n"],"color":"#432","bgcolor":"#653"},{"id":103,"type":"Note","pos":[140,0],"size":[440,100],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Since umt5 is a variant based on T5, the input of prompt supports multiple languages.\n\n---\n\n由于 umt5 是基于 T5 的变体，所以提示词输入是支持多种语言输入的"],"color":"#432","bgcolor":"#653"},{"id":38,"type":"CLIPLoader","pos":[-280,187.3333282470703],"size":[390,106],"flags":{},"order":3,"mode":0,"inputs":[{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null},{"localized_name":"type","name":"type","type":"COMBO","widget":{"name":"type"},"link":null},{"localized_name":"device","name":"device","shape":7,"type":"COMBO","widget":{"name":"device"},"link":null}],"outputs":[{"localized_name":"CLIP","name":"CLIP","type":"CLIP","slot_index":0,"links":[74,75]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"CLIPLoader","models":[{"name":"umt5_xxl_fp16.safetensors","url":"https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/text_encoders/umt5_xxl_fp16.safetensors","hash":"7b8850f1961e1cf8a77cca4c964a358d303f490833c6c087d0cff4b2f99db2af","hash_type":"SHA256","directory":"text_encoders"}]},"widgets_values":["umt5_xxl_fp16.safetensors","wan","default"]},{"id":66,"type":"CLIPLoader","pos":[-280,348.6666564941406],"size":[390,106],"flags":{},"order":4,"mode":4,"inputs":[{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null},{"localized_name":"type","name":"type","type":"COMBO","widget":{"name":"type"},"link":null},{"localized_name":"device","name":"device","shape":7,"type":"COMBO","widget":{"name":"device"},"link":null}],"outputs":[{"localized_name":"CLIP","name":"CLIP","type":"CLIP","slot_index":0,"links":[]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"CLIPLoader","models":[{"name":"umt5_xxl_fp8_e4m3fn_scaled.safetensors","url":"https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/text_encoders/umt5_xxl_fp8_e4m3fn_scaled.safetensors","hash":"c3355d30191f1f066b26d93fba017ae9809dce6c627dda5f6a66eaa651204f68","hash_type":"SHA256","directory":"text_encoders"}]},"widgets_values":["umt5_xxl_fp8_e4m3fn_scaled.safetensors","wan","default"]},{"id":39,"type":"VAELoader","pos":[-280,510],"size":[390,60],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null}],"outputs":[{"localized_name":"VAE","name":"VAE","type":"VAE","slot_index":0,"links":[76,101]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"VAELoader","models":[{"name":"wan_2.1_vae.safetensors","url":"https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/vae/wan_2.1_vae.safetensors","hash":"2fc39d31359a4b0a64f55876d8ff7fa8d780956ae2cb13463b0223e15148976b","hash_type":"SHA256","directory":"vae"}]},"widgets_values":["wan_2.1_vae.safetensors"]},{"id":70,"type":"SaveAnimatedWEBP","pos":[2110,200],"size":[670,780],"flags":{},"order":20,"mode":4,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":130},{"localized_name":"filename_prefix","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"fps","name":"fps","type":"FLOAT","widget":{"name":"fps"},"link":null},{"localized_name":"lossless","name":"lossless","type":"BOOLEAN","widget":{"name":"lossless"},"link":null},{"localized_name":"quality","name":"quality","type":"INT","widget":{"name":"quality"},"link":null},{"localized_name":"method","name":"method","type":"COMBO","widget":{"name":"method"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"SaveAnimatedWEBP"},"widgets_values":["ComfyUI",6,true,80,"default"]},{"id":75,"type":"PreviewImage","pos":[920,670],"size":[409.20550537109375,246],"flags":{},"order":15,"mode":4,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":141}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"PreviewImage"},"widgets_values":[]},{"id":72,"type":"GetVideoComponents","pos":[360,690],"size":[185.17733764648438,66],"flags":{},"order":11,"mode":4,"inputs":[{"localized_name":"video","name":"video","type":"VIDEO","link":131}],"outputs":[{"localized_name":"images","name":"images","type":"IMAGE","links":[140]},{"localized_name":"audio","name":"audio","type":"AUDIO","links":null},{"localized_name":"fps","name":"fps","type":"FLOAT","links":[]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"GetVideoComponents"},"widgets_values":[]},{"id":76,"type":"PreviewAny","pos":[360,820],"size":[210,88],"flags":{},"order":12,"mode":4,"inputs":[{"localized_name":"source","name":"source","type":"*","link":166}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"PreviewAny"},"widgets_values":[]},{"id":71,"type":"LoadVideo","pos":[40,690],"size":[274.080078125,228.1700439453125],"flags":{},"order":6,"mode":4,"inputs":[{"localized_name":"file","name":"file","type":"COMBO","widget":{"name":"file"},"link":null},{"localized_name":"choose file to upload","name":"upload","type":"IMAGEUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"VIDEO","name":"VIDEO","type":"VIDEO","links":[131,166]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"LoadVideo"},"widgets_values":["11111.mp4","image"]},{"id":3,"type":"KSampler","pos":[989.7294311523438,204.32412719726562],"size":[315,262],"flags":{},"order":17,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"MODEL","link":95},{"localized_name":"positive","name":"positive","type":"CONDITIONING","link":98},{"localized_name":"negative","name":"negative","type":"CONDITIONING","link":99},{"localized_name":"latent_image","name":"latent_image","type":"LATENT","link":160},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null},{"localized_name":"steps","name":"steps","type":"INT","widget":{"name":"steps"},"link":null},{"localized_name":"cfg","name":"cfg","type":"FLOAT","widget":{"name":"cfg"},"link":null},{"localized_name":"sampler_name","name":"sampler_name","type":"COMBO","widget":{"name":"sampler_name"},"link":null},{"localized_name":"scheduler","name":"scheduler","type":"COMBO","widget":{"name":"scheduler"},"link":null},{"localized_name":"denoise","name":"denoise","type":"FLOAT","widget":{"name":"denoise"},"link":null}],"outputs":[{"localized_name":"LATENT","name":"LATENT","type":"LATENT","slot_index":0,"links":[116]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"KSampler"},"widgets_values":[183883102905340,"randomize",20,4,"uni_pc","simple",1]},{"id":7,"type":"CLIPTextEncode","pos":[149.87985229492188,401.6088562011719],"size":[425.27801513671875,180.6060791015625],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"clip","name":"clip","type":"CLIP","link":75},{"localized_name":"text","name":"text","type":"STRING","widget":{"name":"text"},"link":null}],"outputs":[{"localized_name":"CONDITIONING","name":"CONDITIONING","type":"CONDITIONING","slot_index":0,"links":[97]}],"title":"CLIP Text Encode (Negative Prompt)","properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"CLIPTextEncode"},"widgets_values":["bad quality, blurry, messy, chaotic"],"color":"#322","bgcolor":"#533"},{"id":68,"type":"CreateVideo","pos":[1360,20],"size":[270,78],"flags":{"collapsed":false},"order":21,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":139},{"localized_name":"audio","name":"audio","shape":7,"type":"AUDIO","link":null},{"localized_name":"fps","name":"fps","type":"FLOAT","widget":{"name":"fps"},"link":null}],"outputs":[{"localized_name":"VIDEO","name":"VIDEO","type":"VIDEO","links":[129]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"CreateVideo"},"widgets_values":[16]},{"id":37,"type":"UNETLoader","pos":[-270,50],"size":[380,82],"flags":{},"order":7,"mode":0,"inputs":[{"localized_name":"unet_name","name":"unet_name","type":"COMBO","widget":{"name":"unet_name"},"link":null},{"localized_name":"weight_dtype","name":"weight_dtype","type":"COMBO","widget":{"name":"weight_dtype"},"link":null}],"outputs":[{"localized_name":"MODEL","name":"MODEL","type":"MODEL","slot_index":0,"links":[109]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"UNETLoader","models":[{"name":"wan2.1_vace_14B_fp16.safetensors","url":"https://huggingface.co/Comfy-Org/Wan_2.1_ComfyUI_repackaged/resolve/main/split_files/diffusion_models/wan2.1_vace_14B_fp16.safetensors","hash":"f202a5c59b8a91ada1862c46a038214f1f7f216c61ec8350d25f69b919da4307","hash_type":"SHA256","directory":"diffusion_models"}]},"widgets_values":["wan2.1_vace_1.3B_fp16.safetensors","default"]},{"id":73,"type":"LoadImage","pos":[-280,680],"size":[274.080078125,314.00006103515625],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"COMBO","widget":{"name":"image"},"link":null},{"localized_name":"choose file to upload","name":"upload","type":"IMAGEUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[175]},{"localized_name":"MASK","name":"MASK","type":"MASK","links":null}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"LoadImage"},"widgets_values":["dragon.jpg","image"]},{"id":6,"type":"CLIPTextEncode","pos":[149.87985229492188,191.60894775390625],"size":[422.84503173828125,164.31304931640625],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"clip","name":"clip","type":"CLIP","link":74},{"localized_name":"text","name":"text","type":"STRING","widget":{"name":"text"},"link":null}],"outputs":[{"localized_name":"CONDITIONING","name":"CONDITIONING","type":"CONDITIONING","slot_index":0,"links":[96]}],"title":"CLIP Text Encode (Positive Prompt)","properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"CLIPTextEncode"},"widgets_values":["An icicle dragon lunges forward, mouth wide open to exhale a stream of icy mist. Ultramarine energy flickers beneath its frost-coated scales as it twists. The camera circles slowly, capturing the swirling ice particles and the backdrop of floating glaciers and frozen nebulae under a cyan-blue filter."],"color":"#232","bgcolor":"#353"},{"id":49,"type":"WanVaceToVideo","pos":[639.7293701171875,214.32412719726562],"size":[315,254],"flags":{},"order":16,"mode":0,"inputs":[{"localized_name":"positive","name":"positive","type":"CONDITIONING","link":96},{"localized_name":"negative","name":"negative","type":"CONDITIONING","link":97},{"localized_name":"vae","name":"vae","type":"VAE","link":101},{"localized_name":"control_video","name":"control_video","shape":7,"type":"IMAGE","link":174},{"localized_name":"control_masks","name":"control_masks","shape":7,"type":"MASK","link":null},{"localized_name":"reference_image","name":"reference_image","shape":7,"type":"IMAGE","link":175},{"localized_name":"width","name":"width","type":"INT","widget":{"name":"width"},"link":null},{"localized_name":"height","name":"height","type":"INT","widget":{"name":"height"},"link":null},{"localized_name":"length","name":"length","type":"INT","widget":{"name":"length"},"link":null},{"localized_name":"batch_size","name":"batch_size","type":"INT","widget":{"name":"batch_size"},"link":null},{"localized_name":"strength","name":"strength","type":"FLOAT","widget":{"name":"strength"},"link":null}],"outputs":[{"localized_name":"positive","name":"positive","type":"CONDITIONING","links":[98]},{"localized_name":"negative","name":"negative","type":"CONDITIONING","links":[99]},{"localized_name":"latent","name":"latent","type":"LATENT","links":[160]},{"localized_name":"trim_latent","name":"trim_latent","type":"INT","links":[115]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"WanVaceToVideo"},"widgets_values":[720,640,89,1,1]},{"id":69,"type":"SaveVideo","pos":[1380,210],"size":[676.23095703125,774.23095703125],"flags":{},"order":22,"mode":0,"inputs":[{"localized_name":"video","name":"video","type":"VIDEO","link":129},{"localized_name":"filename_prefix","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"format","name":"format","type":"COMBO","widget":{"name":"format"},"link":null},{"localized_name":"codec","name":"codec","type":"COMBO","widget":{"name":"codec"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"SaveVideo"},"widgets_values":["video/ComfyUI","auto","auto"]},{"id":48,"type":"ModelSamplingSD3","pos":[710.5535278320312,38.91897201538086],"size":[210,58],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"MODEL","link":109},{"localized_name":"shift","name":"shift","type":"FLOAT","widget":{"name":"shift"},"link":null}],"outputs":[{"localized_name":"MODEL","name":"MODEL","type":"MODEL","slot_index":0,"links":[95]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.34","Node name for S&R":"ModelSamplingSD3"},"widgets_values":[8.000000000000002]}],"links":[[74,38,0,6,0,"CLIP"],[75,38,0,7,0,"CLIP"],[76,39,0,8,1,"VAE"],[95,48,0,3,0,"MODEL"],[96,6,0,49,0,"CONDITIONING"],[97,7,0,49,1,"CONDITIONING"],[98,49,0,3,1,"CONDITIONING"],[99,49,1,3,2,"CONDITIONING"],[101,39,0,49,2,"VAE"],[109,37,0,48,0,"MODEL"],[115,49,3,58,1,"INT"],[116,3,0,58,0,"LATENT"],[117,58,0,8,0,"LATENT"],[129,68,0,69,0,"VIDEO"],[130,8,0,70,0,"IMAGE"],[131,71,0,72,0,"VIDEO"],[139,8,0,68,0,"IMAGE"],[140,72,0,78,0,"IMAGE"],[141,78,0,75,0,"IMAGE"],[160,49,2,3,3,"LATENT"],[166,71,0,76,0,"*"],[174,78,0,49,3,"IMAGE"],[175,73,0,49,5,"IMAGE"]],"groups":[{"id":1,"title":"Load models here","bounding":[-290,-30,410,620],"color":"#3f789e","font_size":24,"flags":{}},{"id":2,"title":"Prompt","bounding":[140,120,450,470],"color":"#3f789e","font_size":24,"flags":{}},{"id":3,"title":"Sampling & Decoding","bounding":[619.7293701171875,124.3241195678711,730,470],"color":"#3f789e","font_size":24,"flags":{}},{"id":4,"title":"Save Video(Mp4)","bounding":[1360,120,720,900],"color":"#3f789e","font_size":24,"flags":{}},{"id":5,"title":"Save Video(WebP)","bounding":[2100,120,700,900],"color":"#3f789e","font_size":24,"flags":{}},{"id":6,"title":"Load control video","bounding":[30,610,560,410],"color":"#3f789e","font_size":24,"flags":{}},{"id":7,"title":"Load reference image","bounding":[-290,610,300,410],"color":"#3f789e","font_size":24,"flags":{}},{"id":8,"title":"Image preprocessing","bounding":[610,610,730,410],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.7400249944258206,"offset":[952.7456239620809,113.54767146273485]},"frontendVersion":"1.19.9","node_versions":{"comfy-core":"0.3.34"},"VHS_latentpreview":false,"VHS_latentpreviewrate":0,"VHS_MetadataImage":true,"VHS_KeepIntermediate":true},"version":0.4}